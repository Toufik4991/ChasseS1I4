<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mouse Heist: Trap & Moon üßÄ</title>
    <style>
        :root { --p: #ffcc00; --s: #00ff88; --danger: #ff4400; --bg: #050505; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; touch-action: none; text-align: center; }
        
        #top-bar { height: 75px; display: flex; flex-direction: column; justify-content: center; background: #111; border-bottom: 2px solid #333; }
        .stats-row { display: flex; justify-content: space-around; font-weight: bold; font-size: 18px; align-items: center; }
        #timer-bar { height: 6px; background: var(--s); width: 100%; margin-top: 5px; transition: width 1s linear; }

        #game-container { position: relative; height: 42vh; background: #000; overflow: hidden; cursor: none; }
        canvas { display: block; width: 100%; height: 100%; }

        #pendu-container { height: 48vh; padding: 10px; opacity: 0.4; pointer-events: none; transition: all 0.5s ease; position: relative; }
        #pendu-container.active { opacity: 1; pointer-events: auto; background: #0a0a0a; }
        
        #wordDisplay { font-size: 24px; letter-spacing: 4px; color: var(--s); font-weight: 800; margin: 15px 0; text-transform: uppercase; }
        #keyboard { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; max-width: 500px; margin: 0 auto; }
        .key { background: #222; padding: 14px 0; border-radius: 8px; font-size: 15px; font-weight: bold; border: 1px solid #444; color: white; }
        .key.used { background: #050505; color: #333; border: 1px solid #111; }
        
        #shop-alert { 
            position: absolute; top: -30px; left: 50%; transform: translateX(-50%);
            background: var(--danger); color: white; padding: 5px 15px; border-radius: 20px;
            font-size: 12px; font-weight: bold; display: none; white-space: nowrap;
            animation: pulse 0.5s infinite alternate;
        }

        @keyframes pulse { from { opacity: 1; } to { opacity: 0.5; } }

        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; z-index: 100; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
        .btn-restart { margin-top: 25px; padding: 18px 40px; background: var(--p); color: black; border: none; border-radius: 12px; font-weight: bold; font-size: 20px; }
    </style>
</head>
<body>

    <div id="top-bar">
        <div class="stats-row">
            <div>üßÄ <span id="energy">0</span></div>
            <div id="clock" style="font-family: monospace;">01:30</div>
            <div>‚ù§Ô∏è <span id="lives">10</span></div>
        </div>
        <div id="timer-bar"></div>
    </div>

    <div id="game-container">
        <canvas id="actionCanvas"></canvas>
    </div>

    <div id="pendu-container">
        <div id="shop-alert">üö® VITE ! 25s POUR ACHETER !</div>
        <div id="wordDisplay">_ _ _ _ _ _ _ _ _ _ _ _ _</div>
        <div id="keyboard"></div>
    </div>

    <div id="overlay">
        <h1 id="res-title" style="font-size: 45px; margin: 10px;"></h1>
        <div id="res-sub" style="font-size: 20px; color: #aaa;"></div>
        <button class="btn-restart" onclick="location.reload()">RECOMMENCER</button>
    </div>

<script>
    const phrase = "BORNE-INCENDIE";
    let guessed = Array.from(phrase).map(c => c === "-" ? "-" : "_");
    let energy = 0, lives = 10, gameActive = true, phaseCollecte = true;
    let timeLeft = 90; 

    const canvas = document.getElementById('actionCanvas');
    const ctx = canvas.getContext('2d');
    let player = { x: 100, y: 100 };
    let items = [];

    function init() {
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;
        player.x = canvas.width / 2;
        player.y = canvas.height / 2;

        "AZERTYUIOPQSDFGHJKLMWXCVBN".split("").forEach(l => {
            const k = document.createElement('div');
            k.className = "key";
            k.textContent = l;
            k.onclick = () => buyLetter(l, k);
            document.getElementById('keyboard').appendChild(k);
        });

        updateUI();
        startPhase1();
        animate();
    }

    function startPhase1() {
        const timerInt = setInterval(() => {
            if (!gameActive) { clearInterval(timerInt); return; }
            timeLeft--;
            updateClock(timeLeft);
            document.getElementById('timer-bar').style.width = (timeLeft/90)*100 + "%";
            if (timeLeft <= 0) { clearInterval(timerInt); startShopPhase(); }
        }, 1000);
    }

    function startShopPhase() {
        phaseCollecte = false;
        timeLeft = 25;
        document.getElementById('pendu-container').classList.add('active');
        document.getElementById('shop-alert').style.display = "block";
        document.getElementById('timer-bar').style.backgroundColor = "var(--danger)";
        const shopTimer = setInterval(() => {
            if (!gameActive) { clearInterval(shopTimer); return; }
            timeLeft--;
            updateClock(timeLeft);
            document.getElementById('timer-bar').style.width = (timeLeft/25)*100 + "%";
            if (timeLeft <= 0) {
                clearInterval(shopTimer);
                if (guessed.includes("_")) endGame("TEMPS √âCOUL√â ! ‚åõ", "D√©p√™che-toi la prochaine fois !");
            }
        }, 1000);
    }

    function updateClock(t) {
        let m = Math.floor(t / 60);
        let s = t % 60;
        document.getElementById('clock').textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }

    function buyLetter(l, el) {
        if (!gameActive || phaseCollecte || energy < 100 || el.classList.contains('used')) return;
        energy -= 100;
        el.classList.add('used');
        let found = false;
        for(let i=0; i<phrase.length; i++) {
            if(phrase[i] === l) { guessed[i] = l; found = true; }
        }
        if(!found) lives--;
        checkGameOver();
        updateUI();
    }

    function handleInput(e) {
        if (!gameActive || !phaseCollecte) return;
        let rect = canvas.getBoundingClientRect();
        let t = e.touches ? e.touches[0] : e;
        player.x = t.clientX;
        player.y = t.clientY - rect.top;
    }

    window.addEventListener('touchmove', e => { e.preventDefault(); handleInput(e); }, {passive:false});
    window.addEventListener('mousemove', handleInput);

    function animate() {
        if(!gameActive) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Souris XXL üê≠
        ctx.font = "52px Arial";
        ctx.textAlign = "center";
        ctx.fillText("üê≠", player.x, player.y + 18);

        if(phaseCollecte) {
            if(Math.random() < 0.05) { // Moins d'objets globalement
                const rand = Math.random();
                let type = 'üßÄ';
                let speed = 2.2 + Math.random() * 1.5;

                if(rand > 0.6 && rand < 0.75) { type = 'ü™§'; speed = 2.0; } // Tapette
                else if(rand > 0.88 && rand < 0.93) { type = 'üî•'; speed = 1.2; } // Feu rare
                else if(rand >= 0.93) { type = 'üåô'; speed = 2.2; } // Lune tr√®s rare
                else if(rand > 0.4) { type = 'üßÄ'; } // Fromage

                items.push({ x: canvas.width + 50, y: Math.random() * (canvas.height - 60) + 30, v: speed, char: type });
            }

            for(let i = items.length-1; i>=0; i--) {
                let it = items[i];
                it.x -= it.v;
                
                // Taille Lune +25%
                ctx.font = it.char === 'üåô' ? "44px Arial" : (it.char === 'üî•' || it.char === 'ü™§' ? "40px Arial" : "32px Arial");
                
                if(it.char === 'üåô') { ctx.shadowBlur = 20; ctx.shadowColor = "white"; }
                ctx.fillText(it.char, it.x, it.y);
                ctx.shadowBlur = 0;

                let dist = Math.hypot(player.x - it.x, player.y - it.y);
                if(dist < 40) {
                    if(it.char === 'üßÄ') energy += 10;
                    else if(it.char === 'üåô') energy += 50;
                    else if(it.char === 'üî•') energy = 0;
                    else if(it.char === 'ü™§') energy = Math.max(0, energy - 20);
                    items.splice(i, 1);
                    updateUI();
                }
                if(it.x < -60) items.splice(i, 1);
            }
        }
        requestAnimationFrame(animate);
    }

    function checkGameOver() {
        if (lives <= 0) endGame("Oups plus de vie", "La souris est fatigu√©e...");
        else if (!guessed.includes("_")) endGame("VICTOIRE ! üßÄ", "Borne-Incendie trouv√©e !");
    }

    function updateUI() {
        document.getElementById('energy').textContent = energy;
        document.getElementById('lives').textContent = lives;
        document.getElementById('wordDisplay').textContent = guessed.join(" ");
    }

    function endGame(title, sub) {
        gameActive = false;
        document.getElementById('overlay').style.display = "flex";
        document.getElementById('res-title').textContent = title;
        document.getElementById('res-sub').textContent = sub;
    }

    init();
</script>
</body>
</html>
